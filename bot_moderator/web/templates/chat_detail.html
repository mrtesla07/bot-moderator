{% extends "base.html" %}
{% block title %}Настройки чата {{ chat_id }} · bot-moderator{% endblock %}
{% block content %}
<a href="/" class="muted">← ко всем чатам</a>
<div class="card" style="margin-top:12px;">
    <h2>Настройки чата</h2>
    <p class="muted">ID: <strong>{{ chat_id }}</strong>{% if chat and chat.title %} · {{ chat.title }}{% endif %}</p>
    {% if saved %}
    <div class="notice">Настройки сохранены.</div>
    {% endif %}
    <form method="post">
        <div class="form-row">
            <label for="subscription_tier">Подписка</label>
            <select id="subscription_tier" name="subscription_tier">
                <option value="free" {% if settings.subscription.tier == 'free' %}selected{% endif %}>Free</option>
                <option value="premium" {% if settings.subscription.tier == 'premium' %}selected{% endif %}>Premium</option>
            </select>
        </div>
        <div class="form-row">
            <label for="flood_message_limit">Антифлуд: сообщений за интервал</label>
            <input type="number" id="flood_message_limit" name="flood_message_limit" min="1" value="{{ settings.flood.message_limit }}">
        </div>
        <div class="form-row">
            <label for="flood_interval_seconds">Антифлуд: длина интервала (сек.)</label>
            <input type="number" id="flood_interval_seconds" name="flood_interval_seconds" min="1" value="{{ settings.flood.interval_seconds }}">
        </div>
        <div class="form-row">
            <label for="flood_punishment">Антифлуд: действие</label>
            <select id="flood_punishment" name="flood_punishment">
                <option value="mute" {% if settings.flood.punishment == 'mute' %}selected{% endif %}>Mute</option>
                <option value="ban" {% if settings.flood.punishment == 'ban' %}selected{% endif %}>Ban</option>
                <option value="delete" {% if settings.flood.punishment == 'delete' %}selected{% endif %}>Delete</option>
            </select>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="stop_words_enabled" name="stop_words_enabled" value="on" {% if settings.stop_words.enabled %}checked{% endif %}>
            <label for="stop_words_enabled" style="font-weight:normal;">Включить стоп-слова</label>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="captcha_enabled" name="captcha_enabled" value="on" {% if settings.captcha.enabled %}checked{% endif %}>
            <label for="captcha_enabled" style="font-weight:normal;">Включить капчу для новых участников</label>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="silent_enabled" name="silent_enabled" value="on" {% if settings.silent_mode.enabled %}checked{% endif %}>
            <label for="silent_enabled" style="font-weight:normal;">Тихий режим (скрыть служебные уведомления)</label>
        </div>
        <div class="form-row">
            <label for="welcome_text">Приветственное сообщение</label>
            <textarea id="welcome_text" name="welcome_text">{{ settings.welcome.text }}</textarea>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="reports_enabled" name="reports_enabled" value="on" {% if settings.reports.enabled %}checked{% endif %}>
            <label for="reports_enabled" style="font-weight:normal;">Отправлять отчёты о срабатывании правил</label>
        </div>
        <div class="form-row">
            <label for="reports_chat_id">Чат для отчётов (ID)</label>
            <input type="text" id="reports_chat_id" name="reports_chat_id" value="{{ settings.reports.destination_chat_id or '' }}">
        </div>
        <button type="submit" class="btn">Сохранить</button>
    </form>
</div>
{% endblock %}
